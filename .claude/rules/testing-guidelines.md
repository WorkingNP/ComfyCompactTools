# テストガイドライン

テスト作成・レビュー時に必ずこのチェックリストを適用すること。

---

## テストレビュー時の必須チェック

### 画像生成テスト
- [ ] ファイル存在チェックあるか
- [ ] ファイルサイズ > 0 チェックあるか
- [ ] 画像フォーマット検証あるか（Pillowで開けるか）
- [ ] 画像サイズ（width/height）検証あるか
- [ ] 真っ黒/真っ白の検出ロジックあるか
  - なければ理由を確認（意図的なスキップか見落としか）
  - 検出例: `ImageStat.Stat(im).mean` の各チャンネルが極端（<5 or >250）でないか

### API連携テスト
- [ ] 接続成功時の正常系テストあるか
- [ ] 接続失敗時のエラーメッセージが明確か
- [ ] タイムアウト設定が適切か
- [ ] リトライロジックがあれば、その検証あるか

### ファイル入出力テスト
- [ ] 一時ディレクトリ（tmp_path等）を使用しているか
- [ ] テスト後のクリーンアップは適切か
- [ ] パス区切り文字がOS非依存か（pathlib使用推奨）

---

## 過去の教訓

### 2025-01: Flux2 画像生成テスト
- **問題**: テストがパスしたが、実際には真っ黒画像だった
- **原因**: ファイル存在・サイズ・Pillow検証のみで、画像内容の検証なし
- **対策**: 画像内容の最低限チェック（真っ黒/真っ白検出）を検討項目に追加

---

## チェックリスト適用手順

1. 既存テストコードを読む
2. 上記チェックリストの各項目を確認
3. 不足があれば：
   - 意図的なスキップか確認
   - 必要なら修正提案または実装
4. 判断に迷う場合はユーザーに確認
