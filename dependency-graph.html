<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>grok-comfy-cockpit2 ä¾å­˜é–¢ä¿‚å›³</title>
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow: hidden;
        }

        #header {
            background: #161b22;
            padding: 20px;
            border-bottom: 1px solid #30363d;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #58a6ff;
        }

        #controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        button:hover {
            background: #2ea043;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        #cy {
            width: 100%;
            height: calc(100vh - 150px);
            background: #0d1117;
        }

        .info {
            font-size: 13px;
            color: #8b949e;
            margin-top: 8px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #30363d;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>ğŸš€ grok-comfy-cockpit2 ä¾å­˜é–¢ä¿‚å›³</h1>
        <div class="info">
            ãƒãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é…ç½®å¤‰æ›´ | ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ  | ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        </div>
        <div id="controls">
            <button onclick="resetLayout()">ğŸ”„ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="fitView()">ğŸ” å…¨ä½“è¡¨ç¤º</button>
            <button onclick="centerCore()">ğŸ¯ ã‚³ã‚¢è¡¨ç¤º</button>
            <button onclick="toggleEdgeLabels()">ğŸ·ï¸ ãƒ©ãƒ™ãƒ«åˆ‡æ›¿</button>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #58a6ff;"></div>
                <span>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3fb950;"></div>
                <span>ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚³ã‚¢ï¼‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #d29922;"></div>
                <span>ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚µãƒ–ï¼‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8957e5;"></div>
                <span>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f85149;"></div>
                <span>å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #a371f7;"></div>
                <span>ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff7b72;"></div>
                <span>ãƒ†ã‚¹ãƒˆ</span>
            </div>
        </div>
    </div>

    <div id="cy"></div>

    <script>
        let showEdgeLabels = true;

        const cy = cytoscape({
            container: document.getElementById('cy'),

            elements: [
                // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
                { data: { id: 'browser', label: 'ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶UI\nindex.html', category: 'frontend' } },
                { data: { id: 'appjs', label: 'âš›ï¸ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰\napp.js', category: 'frontend' } },

                // ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚³ã‚¢ï¼‰
                { data: { id: 'main', label: 'ğŸ® ã‚µãƒ¼ãƒãƒ¼ãƒ¡ã‚¤ãƒ³\nmain.py', category: 'server-core' } },

                // ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
                { data: { id: 'comfy-client', label: 'ğŸ”Œ ComfyUI\nã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ', category: 'server-sub' } },
                { data: { id: 'workflow-registry', label: 'ğŸ“š ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\nãƒ¬ã‚¸ã‚¹ãƒˆãƒª', category: 'server-sub' } },
                { data: { id: 'workflow-patcher', label: 'ğŸ”§ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\nãƒ‘ãƒƒãƒãƒ£ãƒ¼', category: 'server-sub' } },
                { data: { id: 'model-scanner', label: 'ğŸ” ãƒ¢ãƒ‡ãƒ«\nã‚¹ã‚­ãƒ£ãƒŠãƒ¼', category: 'server-sub' } },
                { data: { id: 'db', label: 'ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\ndb.py', category: 'server-sub' } },
                { data: { id: 'events', label: 'ğŸ“¡ WebSocket\nç®¡ç†', category: 'server-sub' } },
                { data: { id: 'storage', label: 'ğŸ“¦ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸\nstorage.py', category: 'server-sub' } },
                { data: { id: 'mcp-tools', label: 'ğŸ› ï¸ MCPãƒ„ãƒ¼ãƒ«\nmcp_tools.py', category: 'server-sub' } },

                // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
                { data: { id: 'wf-sdxl', label: 'ğŸ¨ SDXL\ntxt2img', category: 'workflow' } },
                { data: { id: 'wf-flux2', label: 'âš¡ Flux2 Klein\nDistilled', category: 'workflow' } },
                { data: { id: 'wf-sd15', label: 'ğŸ–¼ï¸ SD1.5\ntxt2img', category: 'workflow' } },

                // å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
                { data: { id: 'comfyui', label: 'ğŸ¨ ComfyUI API\nlocalhost:8188', category: 'external' } },
                { data: { id: 'grok', label: 'ğŸ¤– Grok API\napi.x.ai', category: 'external' } },

                // Pythonä¾å­˜
                { data: { id: 'fastapi', label: 'âš¡ FastAPI', category: 'dependency' } },
                { data: { id: 'httpx', label: 'ğŸŒ httpx', category: 'dependency' } },
                { data: { id: 'websockets', label: 'ğŸ“¡ websockets', category: 'dependency' } },
                { data: { id: 'mcp', label: 'ğŸ”— MCP', category: 'dependency' } },

                // Node.jsä¾å­˜
                { data: { id: 'playwright', label: 'ğŸ­ Playwright', category: 'dependency' } },
                { data: { id: 'agent-browser', label: 'ğŸ¤– Agent\nBrowser', category: 'dependency' } },

                // ãƒ†ã‚¹ãƒˆ
                { data: { id: 'tests', label: 'ğŸ§ª E2Eãƒ†ã‚¹ãƒˆ\ntests/', category: 'test' } },

                // ã‚¨ãƒƒã‚¸ï¼ˆä¾å­˜é–¢ä¿‚ï¼‰
                { data: { source: 'browser', target: 'appjs', label: 'è¡¨ç¤º' } },
                { data: { source: 'appjs', target: 'main', label: 'HTTP/WS' } },

                // ãƒ¡ã‚¤ãƒ³ â†’ ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
                { data: { source: 'main', target: 'comfy-client', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'workflow-registry', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'workflow-patcher', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'model-scanner', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'db', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'events', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'storage', label: 'ä½¿ç”¨' } },
                { data: { source: 'main', target: 'mcp-tools', label: 'ä½¿ç”¨' } },

                // ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“
                { data: { source: 'workflow-patcher', target: 'workflow-registry', label: 'å‚ç…§' } },

                // å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶š
                { data: { source: 'comfy-client', target: 'comfyui', label: 'API' } },
                { data: { source: 'main', target: 'grok', label: 'API' } },

                // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
                { data: { source: 'workflow-registry', target: 'wf-sdxl', label: 'ç®¡ç†' } },
                { data: { source: 'workflow-registry', target: 'wf-flux2', label: 'ç®¡ç†' } },
                { data: { source: 'workflow-registry', target: 'wf-sd15', label: 'ç®¡ç†' } },

                // Pythonä¾å­˜
                { data: { source: 'main', target: 'fastapi', label: 'ä¾å­˜' } },
                { data: { source: 'main', target: 'httpx', label: 'ä¾å­˜' } },
                { data: { source: 'main', target: 'websockets', label: 'ä¾å­˜' } },
                { data: { source: 'mcp-tools', target: 'mcp', label: 'ä¾å­˜' } },

                // ãƒ†ã‚¹ãƒˆ
                { data: { source: 'tests', target: 'playwright', label: 'ä½¿ç”¨' } },
                { data: { source: 'tests', target: 'agent-browser', label: 'ä½¿ç”¨' } },
                { data: { source: 'tests', target: 'main', label: 'ãƒ†ã‚¹ãƒˆ' } },
                { data: { source: 'tests', target: 'appjs', label: 'ãƒ†ã‚¹ãƒˆ' } },
            ],

            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'font-size': '12px',
                        'color': '#ffffff',
                        'text-wrap': 'wrap',
                        'text-max-width': '120px',
                        'width': '100px',
                        'height': '80px',
                        'shape': 'roundrectangle',
                        'border-width': 2,
                        'border-color': '#30363d',
                        'background-color': '#161b22',
                        'font-family': 'Segoe UI, sans-serif',
                        'text-outline-width': 0,
                        'padding': '10px'
                    }
                },
                {
                    selector: 'node[category="frontend"]',
                    style: {
                        'background-color': '#58a6ff',
                        'border-color': '#1f6feb'
                    }
                },
                {
                    selector: 'node[category="server-core"]',
                    style: {
                        'background-color': '#3fb950',
                        'border-color': '#2ea043',
                        'width': '120px',
                        'height': '90px',
                        'font-size': '14px',
                        'font-weight': 'bold'
                    }
                },
                {
                    selector: 'node[category="server-sub"]',
                    style: {
                        'background-color': '#d29922',
                        'border-color': '#bf8700'
                    }
                },
                {
                    selector: 'node[category="workflow"]',
                    style: {
                        'background-color': '#8957e5',
                        'border-color': '#6e40c9'
                    }
                },
                {
                    selector: 'node[category="external"]',
                    style: {
                        'background-color': '#f85149',
                        'border-color': '#da3633',
                        'shape': 'diamond',
                        'width': '110px',
                        'height': '110px'
                    }
                },
                {
                    selector: 'node[category="dependency"]',
                    style: {
                        'background-color': '#a371f7',
                        'border-color': '#8957e5',
                        'shape': 'ellipse',
                        'width': '90px',
                        'height': '70px'
                    }
                },
                {
                    selector: 'node[category="test"]',
                    style: {
                        'background-color': '#ff7b72',
                        'border-color': '#f85149'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#30363d',
                        'target-arrow-color': '#30363d',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'label': 'data(label)',
                        'font-size': '10px',
                        'color': '#8b949e',
                        'text-rotation': 'autorotate',
                        'text-background-color': '#0d1117',
                        'text-background-opacity': 0.8,
                        'text-background-padding': '3px',
                        'text-background-shape': 'roundrectangle'
                    }
                },
                {
                    selector: 'node:selected',
                    style: {
                        'border-width': 4,
                        'border-color': '#ffa657',
                        'overlay-opacity': 0.2,
                        'overlay-color': '#ffa657'
                    }
                },
                {
                    selector: 'edge:selected',
                    style: {
                        'line-color': '#ffa657',
                        'target-arrow-color': '#ffa657',
                        'width': 3
                    }
                }
            ],

            layout: {
                name: 'cose',
                animate: true,
                animationDuration: 1000,
                nodeRepulsion: 8000,
                idealEdgeLength: 100,
                edgeElasticity: 100,
                nestingFactor: 5,
                gravity: 80,
                numIter: 1000,
                randomize: false,
                componentSpacing: 100,
                nodeOverlap: 20,
                padding: 30
            }
        });

        // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        cy.on('dbltap', 'node', function(evt) {
            cy.animate({
                fit: {
                    eles: evt.target.neighborhood().add(evt.target),
                    padding: 50
                },
                duration: 500
            });
        });

        function resetLayout() {
            cy.layout({
                name: 'cose',
                animate: true,
                animationDuration: 1000,
                nodeRepulsion: 8000,
                idealEdgeLength: 100,
                edgeElasticity: 100,
                nestingFactor: 5,
                gravity: 80,
                numIter: 1000,
                randomize: true,
                componentSpacing: 100,
                nodeOverlap: 20,
                padding: 30
            }).run();
        }

        function fitView() {
            cy.fit(null, 50);
        }

        function centerCore() {
            const coreNode = cy.getElementById('main');
            cy.animate({
                fit: {
                    eles: coreNode.neighborhood().add(coreNode),
                    padding: 80
                },
                duration: 500
            });
        }

        function toggleEdgeLabels() {
            showEdgeLabels = !showEdgeLabels;
            cy.style()
                .selector('edge')
                .style('label', showEdgeLabels ? 'data(label)' : '')
                .update();
        }

        // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        cy.on('mouseover', 'node', function(evt) {
            evt.target.style('border-width', 3);
        });

        cy.on('mouseout', 'node', function(evt) {
            if (!evt.target.selected()) {
                evt.target.style('border-width', 2);
            }
        });
    </script>
</body>
</html>
