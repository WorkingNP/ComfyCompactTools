# docs/ai/WORKFLOW.md

このプロジェクトの“AI駆動開発”の標準手順です。
目的は **(1) 並列実装のブレを確率で下げる** と同時に **(2) 意図をテストで固定してコンテキスト問題を消す** こと。

---

## 0. 用語
- **チケット**：やりたいことの契約（Goal / Non-goals / 受け入れ条件）
- **受け入れテスト**：ユーザー導線の合否判定（Playwright推奨）
- **実装エージェント**：テストが通るまで実装する役

---

## 1. フロー（最短ループ）
1) `docs/tickets/TICKET-xxx.md` を作る（or テンプレから）
2) 受け入れテストを追加・更新する（落ちる状態が正しい）
3) 実装エージェントへ：「このテストが通るまで実装して」
4) テストが通ったらレビュー（差分・意図・リスク）
5) mainへマージ、作業枝を掃除

---

## 2. “失敗したら再プラン”の判定
次のどれかに当てはまったら、いったん差分を捨てて **チケット/テストを改善して** 再実装する。

- 仕様解釈がズレている（UI/挙動が別物）
- つぎはぎパッチが増えて説明が長くなる
- 触るファイルが広がり続ける

---

## 3. 実装エージェントに渡す最小指示（テンプレ）
- 「`docs/tickets/TICKET-xxx.md` と `tests/...` を読んでください」
- 「受け入れテストが通るまで実装を反復してください」
- 「必要最小限の変更だけ。新規依存は追加しない」
- 「通ったら、変更点・実行コマンド・リスクを短く報告して停止」

---

## 4. UI導線の原則（このプロジェクトの癖）
-  **縦スクロール不要の画面構成にする**（視線移動/認知負荷を減らす）
- 各カラム・タブ・入力欄の内部スクロールはOK
- ボタン等の主要アクションは“見える場所”に置く
- 状態が変わったらフィードバック（toast/ラベル/ダイアログ）を返す

---

## 5. worktree運用（任意）
- 1機能 = 1 worktree（ブランチ）
- 失敗したら worktree ごと捨てる（差分を積み上げない）

※worktreeの具体手順は、READMEや別ドキュメントにまとめるのが推奨。
